# 猫语TTS集成说明

## 功能概述

猫语TTS是一个特殊的TTS提供者，它不会将文本转换为语音，而是根据大语言模型返回的文本中的情绪，返回预先录制好的猫叫声。这让小智客户端以为在与一只猫交流。

## 猫叫声类型识别

系统支持识别以下9种猫叫声类型：

1. **喵 (meow)** - 求关注、撒娇、期待、轻微抱怨
2. **呼噜 (purr)** - 放松、满足、安全感
3. **咕噜咕噜/颤音 (trill)** - 友好、欢迎
4. **咔咔/啾啾 (chattering)** - 兴奋、专注、略挫败
5. **哈气 (hiss)** - 恐惧、防御、警告
6. **低吼/咆哮 (growl)** - 威胁、愤怒、防御升级
7. **嚎叫/长嗷 (yowl)** - 发情、压力、焦虑、疼痛
8. **尖叫/惨叫 (scream)** - 突然疼痛、强烈惊吓
9. **嘟嘟嘟不满声/咕哝 (mutter)** - 不耐烦、轻度烦躁

详细说明和关键词列表请参考：[猫叫声类型详细说明](./cat-language-sound-types.md)

## 猫叫声类型标签格式

除了关键词识别，系统还支持以下格式的标签（优先级最高）：

- `[sound:meow]` - 喵
- `[sound:purr]` - 呼噜
- `<sound>trill</sound>` - 咕噜咕噜/颤音
- `猫叫:chattering` - 咔咔/啾啾
- `叫声:growl` - 低吼/咆哮

支持的9种类型：meow, purr, trill, chattering, hiss, growl, yowl, scream, mutter

## 文件夹结构

在服务器上创建以下文件夹结构来存放猫叫声文件：

```
config/cat_sounds/
├── meow/        # 喵 - 求关注、撒娇、期待、轻微抱怨
├── purr/        # 呼噜 - 放松、满足、安全感
├── trill/       # 咕噜咕噜/颤音 - 友好、欢迎
├── chattering/  # 咔咔/啾啾 - 兴奋、专注、略挫败
├── hiss/        # 哈气 - 恐惧、防御、警告
├── growl/       # 低吼/咆哮 - 威胁、愤怒、防御升级
├── yowl/        # 嚎叫/长嗷 - 发情、压力、焦虑、疼痛
├── scream/      # 尖叫/惨叫 - 突然疼痛、强烈惊吓
└── mutter/      # 嘟嘟嘟不满声/咕哝 - 不耐烦、轻度烦躁
```

详细说明请参考：[猫叫声类型详细说明](./cat-language-sound-types.md)

## 支持的音频格式

- `.wav`
- `.mp3`
- `.ogg`
- `.m4a`

## 配置说明

### 在Web界面配置

1. 登录小智服务器Web管理界面
2. 进入"模型配置" -> "TTS"
3. 点击"新增"按钮
4. 在"供应器"下拉菜单中选择"猫语"
5. 配置以下参数：
   - **猫叫声文件夹路径** (`cat_sounds_dir`): 默认为 `config/cat_sounds`
   - **默认猫叫声类型** (`default_sound_type`): 当无法识别时使用的默认类型，默认为 `meow`

### 在配置文件中配置

在 `config.yaml` 中添加以下配置：

```yaml
TTS:
  CatLanguage:
    type: cat_language
    cat_sounds_dir: config/cat_sounds
    default_sound_type: meow
    output_dir: tmp/

selected_module:
  TTS: CatLanguage
```

## 工作原理

1. 当大语言模型返回文本时，猫语TTS提供者会分析文本内容
2. 从文本中提取情绪信息（通过关键词或标签）
3. 根据识别到的情绪，从对应的文件夹中随机选择一个音频文件
4. 将选中的猫叫声文件返回给客户端播放

## 使用建议

1. **准备猫叫声文件**：
   - 为每种猫叫声类型准备多个不同的音频文件，以增加变化性
   - 建议每个类型文件夹至少准备3-5个不同的音频文件
   - 音频文件时长建议在1-5秒之间

2. **大语言模型配置**：
   - 在提示词中要求大语言模型在回复中包含猫叫声类型信息
   - 可以使用标签格式，例如：`[sound:meow]` 或 `<sound>purr</sound>`
   - 或者在回复文本中包含对应的关键词（如：求关注、放松、友好等）

3. **测试**：
   - 测试不同情绪的识别是否准确
   - 确保所有情绪文件夹中都有音频文件
   - 验证音频文件格式是否支持

## 故障排除

### 问题：无法找到猫叫声文件

**解决方案**：
- 检查 `cat_sounds_dir` 配置的路径是否正确
- 确保文件夹结构正确（angry/happy/fearful子文件夹存在）
- 检查音频文件格式是否支持

### 问题：猫叫声类型识别不准确

**解决方案**：
- 在文本中使用明确的标签格式：`[sound:meow]` 或 `<sound>purr</sound>`
- 确保文本中包含对应的关键词（参考[猫叫声类型详细说明](./cat-language-sound-types.md)）
- 如果无法识别，系统会使用默认类型（meow）

### 问题：没有播放声音

**解决方案**：
- 检查对应情绪文件夹中是否有音频文件
- 检查音频文件是否损坏
- 查看服务器日志了解详细错误信息

## 示例

### 示例1：使用标签格式

大语言模型返回：
```
[sound:purr] 今天天气真好，我很放松！
```

系统会识别到"purr"类型，从 `config/cat_sounds/purr/` 文件夹中随机选择一个音频文件播放。

### 示例2：使用关键词

大语言模型返回：
```
我很放松，感觉很满足。
```

系统会识别到"放松"、"满足"关键词，对应"purr"类型，从 `config/cat_sounds/purr/` 文件夹中随机选择一个音频文件播放。

### 示例3：无法识别类型

大语言模型返回：
```
今天是个普通的日子。
```

系统无法识别到明确的类型，会使用默认类型（meow），从 `config/cat_sounds/meow/` 文件夹中随机选择一个音频文件播放。

